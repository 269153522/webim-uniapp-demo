(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/main/main"],{"1bf3":function(e,t,n){"use strict";n.r(t);var a=n("9134"),i=n.n(a);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a},"1ef8":function(e,t,n){"use strict";n.r(t);var a=n("e4b1"),i=n("1bf3");for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("d3f9");var s,r=n("f0c5"),u=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],s);t["default"]=u.exports},"6b4f":function(e,t,n){"use strict";(function(e){n("93cd"),n("921b");a(n("66fd"));var t=a(n("1ef8"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},9134:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("d98b")["default"],i=n("0fac"),o=!1,s=[],r=function(){n.e("comps/swipedelete/swipedelete").then(function(){return resolve(n("1230"))}.bind(null,n)).catch(n.oe)},u={data:function(){return{search_btn:!0,search_friend:!1,show_mask:!1,myName:"",member:[],messageNum:"",unReadSpotNum:0,unReadNoticeNum:0,unReadTotalNotNum:0,isActive:null,listMain:[],listTitles:[],toView:"inToView0",oHeight:[],scroolHeight:0,show_clear:!1,isHideLoadMore:!0,isIPX:!1,gotop:!1,input_code:"",showFixedTitile:!1}},components:{swipeDelete:r},props:{},onLoad:function(e){var t=this;getApp().globalData;i.on("em.subscribe",(function(){t.setData({messageNum:getApp().globalData.saveFriendList.length,unReadTotalNotNum:getApp().globalData.saveFriendList.length+getApp().globalData.saveGroupInvitedList.length})})),i.on("em.contacts.remove",(function(e){var n=getCurrentPages();n[n.length-1].route===t.route&&t.getRoster()})),i.on("em.unreadspot",(function(){t.setData({unReadSpotNum:getApp().globalData.unReadMessageNum>99?"99+":getApp().globalData.unReadMessageNum})})),i.on("em.invite.joingroup",(function(){t.setData({unReadNoticeNum:getApp().globalData.saveGroupInvitedList.length,unReadTotalNotNum:getApp().globalData.saveFriendList.length+getApp().globalData.saveGroupInvitedList.length})})),i.on("em.subscribed",(function(){var e=getCurrentPages();e[e.length-1].route===t.route&&t.getRoster()})),this.setData({myName:e.myName})},onShow:function(){this.setData({messageNum:getApp().globalData.saveFriendList.length,unReadSpotNum:getApp().globalData.unReadMessageNum>99?"99+":getApp().globalData.unReadMessageNum,unReadNoticeNum:getApp().globalData.saveGroupInvitedList.length,unReadTotalNotNum:getApp().globalData.saveFriendList.length+getApp().globalData.saveGroupInvitedList.length}),getApp().globalData.isIPX&&this.setData({isIPX:!0}),this.getRoster()},methods:{getRoster:function(){var e=this,t={success:function(t){for(var n=[],a=0;a<t.length;a++)"both"==t[a].subscription&&n.push(t[a]);wx.setStorage({key:"member",data:n}),e.setData({member:n}),o||(i.fire("em.main.ready"),o=!0),e.getBrands(n)},error:function(e){console.log("[main:getRoster]",e)}};a.conn.getRoster(t)},moveFriend:function(e){var t=this,n={success:function(e){for(var n=[],a=0;a<e.length;a++)"both"==e[a].subscription&&n.push(e[a]);t.setData({member:n})}};"unsubscribe"!=e.type&&"unsubscribed"!=e.type||a.conn.removeRoster({to:e.from,success:function(){a.conn.unsubscribed({to:e.from}),a.conn.getRoster(n)}})},handleFriendMsg:function(e){wx.showModal({title:"添加好友请求",content:e.from+"请求加为好友",success:function(t){1==t.confirm?(a.conn.subscribed({to:e.from,message:"[resp:true]"}),a.conn.subscribe({to:e.from,message:"[resp:true]"})):a.conn.unsubscribed({to:e.from,message:"rejectAddFriend"})},fail:function(e){}})},delete_friend:function(t){var n=this,o=t.currentTarget.dataset.username,s=wx.getStorageSync("myUsername");wx.showModal({title:"确认删除好友"+o,cancelText:"取消",confirmText:"删除",success:function(t){1==t.confirm&&(a.conn.removeRoster({to:o}),e.showToast({title:"删除成功"}),wx.setStorageSync(o+s,""),wx.setStorageSync("rendered_"+o+s,""),n.getRoster(),i.fire("em.main.deleteFriend"))}})},openSearch:function(){this.setData({search_btn:!1,search_friend:!0,show_mask:!0,gotop:!0})},clearInput:function(){this.setData({input_code:"",show_clear:!1})},onInput:function(e){var t=e.detail.value;t?this.setData({show_clear:!0}):this.setData({show_clear:!1})},cancel:function(){this.setData({search_btn:!0,search_friend:!1,gotop:!1}),this.getBrands(this.member)},onSearch:function(e){var t=e.detail.value,n=this.member,a=[];n.forEach((function(e,n){-1!=String(e.name).indexOf(t)&&a.push(e)})),this.getBrands(a)},add_new:function(){wx.navigateTo({url:"../add_new/add_new"})},tab_chat:function(){wx.redirectTo({url:"../chat/chat"})},close_mask:function(){this.setData({search_btn:!0,search_friend:!1})},tab_setting:function(){wx.redirectTo({url:"../setting/setting"})},tab_notification:function(){wx.redirectTo({url:"../notification/notification"})},into_inform:function(){wx.navigateTo({url:"../inform/inform?myName="+this.myName})},into_groups:function(){wx.navigateTo({url:"../groups/groups?myName="+this.myName})},into_room:function(e){var t={myName:this.myName,your:e.target.dataset.username};wx.navigateTo({url:"../chatroom/chatroom?username="+JSON.stringify(t)})},into_info:function(e){wx.navigateTo({url:"../friend_info/friend_info?yourname="+e.target.dataset.username})},scrollToViewFn:function(e){for(var t=this,n=e.target.dataset.id,a=0;a<t.listMain.length;++a)if(t.listMain[a].id===n){t.setData({isActive:n,toView:"inToView"+n});break}},getBrands:function(t){var n=this,a=this,i=/[a-z]/i;t.forEach((function(e){i.test(e.name.substring(0,1))?e.initial=e.name.substring(0,1).toUpperCase():e.initial="#"})),t.sort((function(e,t){return e.initial.charCodeAt(0)-t.initial.charCodeAt(0)}));for(var o=null,r=[],u=0;u<t.length;u++){var c={brandId:t[u].jid,name:t[u].name};if("#"==t[u].initial){if(!l)var l={id:u,region:"#",brands:[]};l.brands.push(c)}else{if(t[u].initial!=o){o=t[u].initial;var d={id:u,region:o,brands:[]};r.push(d)}d.brands.push(c)}}r.sort((function(e,t){return e.region.charCodeAt(0)-t.region.charCodeAt(0)})),l&&r.push(l),a.setData({listMain:r}),a.setData({isActive:r.length>0?r[0].id:""});for(var f=0,g=function(a){var i=e.createSelectorQuery().in(n);i.select("#inToView".concat(r[a].id)).boundingClientRect((function(e){if(e){f=e.height+f;var i=[{height:f,key:e.dataset.id,name:r[a].region}];s=s.concat(i)}else n.$nextTick((function(){n.getBrands(t)}))})).exec()},m=0;m<r.length;++m)g(m)}}};t.default=u}).call(this,n("543d")["default"])},d3f9:function(e,t,n){"use strict";var a=n("f220"),i=n.n(a);i.a},e4b1:function(e,t,n){"use strict";var a,i=function(){var e=this,t=e.$createElement;e._self._c},o=[];n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}))},f220:function(e,t,n){}},[["6b4f","common/runtime","common/vendor"]]]);