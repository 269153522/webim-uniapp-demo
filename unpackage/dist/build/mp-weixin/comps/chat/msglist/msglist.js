(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["comps/chat/msglist/msglist"],{2628:function(t,e,n){"use strict";var i,a=function(){var t=this,e=t.$createElement;t._self._c},o=[];n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}))},3564:function(t,e,n){"use strict";n.r(e);var i=n("4222"),a=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},4222:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n("a563"),a=n("0fac"),o={SHORT:"scroll_view_change",NORMAL:"scroll_view"},r=0,s="",c=!1,u=function(){Promise.all([n.e("common/vendor"),n.e("comps/chat/msglist/type/audio/audio")]).then(function(){return resolve(n("bda1"))}.bind(null,n)).catch(n.oe)},l={data:function(){return{view:o.NORMAL,toView:"",chatMsg:[],__visibility__:!1,isIPX:!1}},components:{audioMsg:u},props:{username:{type:Object,default:function(){return{}}}},created:function(){},beforeMount:function(){this.__visibility__=!0,0,r=0},moved:function(){},destroyed:function(){this.__visibility__=!1},mounted:function(t){var e=this;getApp().globalData.isIPX&&this.setData({isIPX:!0});var n=this.username,o=wx.getStorageSync("myUsername"),r=n.groupId?n.groupId+o:n.your+o,u=wx.getStorageSync(r)||[];console.log("chatMsg>>",u),this.renderMsg(null,null,u,r),wx.setStorageSync(r,null),a.on("em.error.sendMsgErr",(function(t){s=t.data.mid,c=!0})),i.on("newChatMsg",(function(t,i,a,o){e.curChatMsg=a,e.__visibility__&&(n.groupId?t.info.from!=n.groupId&&t.info.to!=n.groupId||o==r&&e.renderMsg(t,i,a,r,"newMsg"):t.info.from!=n.your&&t.info.to!=n.your||o==r&&e.renderMsg(t,i,a,r,"newMsg"))}))},methods:{normalScroll:function(){this.setData({view:o.NORMAL})},shortScroll:function(){this.setData({view:o.SHORT})},onTap:function(){this.$emit("msglistTap",null,{bubbles:!0})},previewImage:function(t){var e=t.target.dataset.url;wx.previewImage({urls:[e]})},getHistoryMsg:function(){var t=this,e=this.username,n=wx.getStorageSync("myUsername"),i=e.groupId?e.groupId+n:e.your+n,a=wx.getStorageSync("rendered_"+i)||[];if(r<a.length){var o=a.slice(-r-10,-r);this.setData({chatMsg:o.concat(t.chatMsg),toView:o[o.length-1].mid}),r+=o.length,10==o.length&&0,wx.stopPullDownRefresh()}},renderMsg:function(e,n,i,a,o){i.length>1&&this.chatMsg.map((function(t,e){i.map((function(e,n){t.mid==e.mid&&i.splice(n,1)}))}));var s=wx.getStorageSync("rendered_"+a)||[];if(s=s.concat(i),s.length){"newMsg"==o?this.setData({chatMsg:this.chatMsg.concat(i),toView:s[s.length-1].mid}):this.setData({chatMsg:s.slice(-10),toView:s[s.length-1].mid}),wx.setStorageSync("rendered_"+a,s);var u=wx.getStorageSync(a)||[];u.map((function(t,e){i.map((function(n,i){n.mid==t.mid&&u.splice(e,1)}))})),wx.setStorageSync(a,u),r=s.slice(-10).length,t.pageScrollTo({scrollTop:9999}),c&&this.renderFail(a)}},renderFail:function(t){var e=this,n=e.chatMsg;n.map((function(t){t.mid.substring(t.mid.length-10)==s.substring(s.length-10)&&(t.msg.data[0].isFail=!0,t.isFail=!0,e.setData({chatMsg:n}))})),e.curChatMsg[0].mid==s&&(e.curChatMsg[0].msg.data[0].isShow=!1,e.curChatMsg[0].isShow=!1),wx.setStorageSync("rendered_"+t,n),c=!1}}};e.default=l}).call(this,n("543d")["default"])},"77a4":function(t,e,n){"use strict";var i=n("f6b7"),a=n.n(i);a.a},c28c:function(t,e,n){"use strict";n.r(e);var i=n("2628"),a=n("3564");for(var o in a)"default"!==o&&function(t){n.d(e,t,(function(){return a[t]}))}(o);n("77a4");var r,s=n("f0c5"),c=Object(s["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],r);e["default"]=c.exports},f6b7:function(t,e,n){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'comps/chat/msglist/msglist-create-component',
    {
        'comps/chat/msglist/msglist-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("c28c"))
        })
    },
    [['comps/chat/msglist/msglist-create-component']]
]);
